\documentclass[letterpaper,11pt,nointlimits,reqno]{amsart}

% Packages
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{cancel}
\usepackage{enumerate}
\usepackage{fancyhdr}
\usepackage{fullpage}
\usepackage{ifthen}
\usepackage{lastpage}
\usepackage{latexsym}
\usepackage{mathtools}
\usepackage{pstricks}
\usepackage{setspace}
\usepackage{txfonts}
\usepackage{units}
\usepackage{varioref}
\usepackage{wrapfig}

\mathtoolsset{showonlyrefs,showmanualtags}
\allowdisplaybreaks[1] % Allow grouped equations to be split across pages

% Line Spacing
\singlespacing

% Set appropriate header/footer information on each page
\fancypagestyle{plain}{
    \fancyhf{}
    \renewcommand{\headheight}{2.0em}
    \renewcommand{\headsep}{0.75em}
    \renewcommand{\headrulewidth}{1.0pt}
    \renewcommand{\footrulewidth}{0pt}
    \lhead{
        Suzerain model derivation, discretization, and numerical considerations
    }
    \rhead{
        Page \thepage{} of \pageref{LastPage}
    }
}
\pagestyle{plain}

% Paragraph spacing
\setlength{\parindent}{0em}
\setlength{\parskip}{2.0ex plus 0.75ex minus 0.75ex}

% Document-specific commands
\newcommand{\ii}{\ensuremath{\mathrm{i}}}
\newcommand{\trans}[1]{{#1}^{\ensuremath{\mathsf{T}}}}
\newcommand{\Reynolds}[1][]{\ensuremath{\mbox{Re}_{#1}}}
\newcommand{\Prandtl}[1][]{\ensuremath{\mbox{Pr}_{#1}}}
\newcommand{\reference}[1]{\ensuremath{\left\{#1\right\}_{0}}}
\newcommand{\lessreference}[1]
  {\ensuremath{\left({#1}-\reference{#1}\right)}}
\newcommand{\symmetricpart}[1]
  {\ensuremath{\operatorname{Sym}\left(#1\right)}}
\DeclareMathOperator{\trace}{tr}

\begin{document}

\section{Model derivation}
\label{seq:derivation}

Here we derive the mathematical model used in Suzerain.  Special attention is
paid to the origins of all conservation laws and constitutive relations
employed.  The model will nondimensionalized after derivation is complete.

\subsection{Conservation laws}

\subsubsection{Reynolds transport theorem}

Consider a time-varying control volume $\Omega$ with surface
$\partial\Omega$ and unit outward normal $\hat{n}$.  For any
scalar, vector, or tensor field quantity
$T$, Leibniz' theorem states
\begin{align}
  \label{eq:rtt}
  \frac{d}{dt}\int_{\Omega(t)}T(x,t)\,dV
  &=
  \int_{\Omega}\frac{\partial}{\partial{}t}T\,dV
  +
  \int_{\partial\Omega} \hat{n}\cdot{}w T\,dA
  =
  \int_{\Omega}\frac{\partial}{\partial{}t}T+\nabla\cdot{}wT\,dV
\end{align}
where $w$ is the velocity of $\partial\Omega$.  When $\Omega$ follows
a fixed set of fluid particles, $w$ becomes the fluid velocity $u$.

\subsubsection{Mass continuity}
Since mass $M=\int_{\Omega} \rho\,dV$
and mass conservation requires $\frac{d}{dt}M=0$,
\begin{align}
  0 = \frac{d}{dt}M
  = \frac{d}{dt}\int_{\Omega} \rho\,dV
  =
  \int_{\Omega}\frac{\partial}{\partial{}t}\rho+\nabla\cdot{}u\rho{}\,dV.
\end{align}
Because the result must hold for any control volume, we obtain
\begin{align}
  \label{eq:cons_mass}
  \frac{\partial}{\partial{}t}\rho+\nabla\cdot\rho{}u &= 0
  .
\end{align}

\subsubsection{Momentum equation}
Separating total force into surface forces and a body force density
\begin{align}
  \sum{}F
  &=
     \int_{\partial\Omega} f_s \, dA
   + \int_{\Omega} \rho{}f_b \, dV
  =
     \int_{\partial\Omega} \sigma \hat{n} \, dA
  +  \int_{\Omega} \rho{}f_b \, dV
  =  \int_{\Omega} \nabla\cdot\sigma + \rho{} f_b \, dV
\end{align}
where $\sigma$ is the Cauchy stress tensor.  Examining
momentum $I=\int_{\Omega} \rho{}u\,dV$ and its conservation
$\frac{d}{dt}I=\sum{}F$,
\begin{align}
    \int_{\Omega}\frac{\partial{}}{\partial{}t}\rho{}u
  + \nabla\cdot(u\otimes{}\rho{}u)\,dV
&= \int_{\Omega} \nabla\cdot\sigma + \rho{} f_b \, dV
.
\end{align}
Because the control volume may be arbitrary,
\begin{align}
  \frac{\partial{}}{\partial{}t}\rho{}u + \nabla\cdot(u\otimes{}\rho{}u)
&= \nabla\cdot\sigma + \rho{} f_b
.
\end{align}
Lastly, we separate the pressure $p$ and viscous contributions $\tau$ to
the Cauchy stress tensor so that $\sigma = -p I + \tau$,
\begin{align}
\label{eq:cons_momentum}
\frac{\partial{}}{\partial{}t}\rho{}u + \nabla\cdot(u\otimes{}\rho{}u)
&= -\nabla{}p + \nabla\cdot{}\tau + \rho{} f_b
.
\end{align}

\subsubsection{Energy equation}
Lumping internal and kinetic energy into an intrinsic density $\tilde{e}$,
the energy $E$ is
\begin{align}
  E &= \int_{\Omega} \rho{}\tilde{e} \, dV
  .
\end{align}
Treating heat input $Q$ as both a surface phenomenon described by an outward
heat flux $q_{s}$ and as a volumetric phenomenon governed by a
body heating density $q_{b}$,
\begin{align}
  Q
  &=
   \int_{\Omega}\rho{}q_{b}\,dV
  -\int_{\partial\Omega}\hat{n}\cdot{}q_{s}\,dA
  =
    \int_{\Omega}\rho{}q_{b} - \nabla\cdot{}q_{s}\,dV
  .
\end{align}
Power input $P=F\cdot{}v$ accounts for surface stress work and body
force work to give
\begin{align}
  P
  &=
    \int_{\partial\Omega} \sigma{}\hat{n} \cdot{} u \, dA
  + \int_{\Omega} \rho{}f_b \cdot{} u \, dV
  = \int_{\Omega} \nabla\cdot{}\sigma{}u + \rho{}f_b \cdot{} u \, dV
  .
\end{align}
Demanding energy conservation $\frac{d}{dt}E=Q+P$,
\begin{align}
  \int_{\Omega}\frac{\partial}{\partial{}t} \rho{}\tilde{e}
  +
  \nabla\cdot{}u\rho{}\tilde{e}
  \,dV
&=
    \int_{\Omega}\rho{}q_{b} - \nabla\cdot{}q_{s}\,dV
  + \int_{\Omega} \nabla\cdot\sigma{}u + \rho{}f_b \cdot{} u \, dV
  .
\end{align}
Again, since the control volume was arbitrary,
\begin{align}
  \frac{\partial}{\partial{}t} \rho{}\tilde{e}
  +
  \nabla\cdot{}\rho{}\tilde{e}u
&=
  - \nabla\cdot{}q_{s}
  + \nabla\cdot\sigma{}u
  + \rho{}f_b \cdot{} u
  + \rho{}q_{b}
  .
\end{align}
After splitting $\sigma$'s pressure and viscous stress contributions we have
\begin{align}
  \label{eq:cons_energy}
  \frac{\partial}{\partial{}t} \rho{}\tilde{e}
  +
  \nabla\cdot{}\rho{}\tilde{e}u
&=
  - \nabla\cdot{}q_{s}
  - \nabla\cdot{}pu
  + \nabla\cdot{}\tau{}u
  + \rho{}f_b \cdot{} u
  + \rho{}q_{b}
  .
\end{align}

\subsection{Constitutive relations and other assumptions}

\subsubsection{Perfect gas}

We assume our fluid is a thermally and calorically perfect gas governed by
\begin{align}
  \label{eq:perfectgaseos}
  p &= \rho{} R T
\end{align}
where $R$ is the gas constant. The constant volume $C_{v}$ specific heat,
constant pressure specific heat $C_{p}$, and acoustic velocity $a$
relationships follow:
\begin{align}
  \label{eq:perfectgasrelations}
  \gamma &= \frac{C_{p}}{C_{v}}
  &
  C_{v} &= \frac{R}{\gamma - 1}
  &
  C_{p} &= \frac{\gamma{}R}{\gamma-1}
  &
  R &= C_{p} - C_{v}
  &
  a^{2} = \gamma{}RT
\end{align}
We assume $\gamma$ and therefore $C_{v}$ and $C_{p}$ are constant.
The total (internal and kinetic) energy density is
\begin{align}
  \label{eq:perfectgastotalenergy}
  \tilde{e} &= C_{v} T + \frac{u\cdot{}u}{2}
     = \frac{RT}{\gamma-1} + \frac{u\cdot{}u}{2}
  .
\end{align}
See a gas dynamics reference, e.g.~\cite{LiepmannRoshko2002}, for more details.

\subsubsection{Newtonian fluid}

If we seek a constitutive law for the viscous stress tensor $\tau$
using only velocity information, the principle of material frame
indifference implies that uniform translation (given by velocity $u$)
and solid-body rotation (given by the skew-symmetric rotation tensor
$\omega=\frac{1}{2}\left( \nabla{}u-\trans{\nabla{}u} \right)$)
may not influence $\tau$.  Considering contributions only up to the
gradient of velocity, extensional strain (dilatation) and shear strain
effects may depend on only the symmetric rate-of-deformation tensor
$\varepsilon=\frac{1}{2}\left( \nabla{}u+\trans{\nabla{}u}\right)$
and its principal invariants.

Assuming $\tau$ is isotropic and depends linearly upon only $\varepsilon$,
we can express it as
\begin{align}
\tau_{ij}
&= c_{ijmn} \varepsilon_{mn}
\notag \\
&= \left( A \delta_{ij} \delta_{mn}
        + B \delta_{im} \delta_{jn}
        + C \delta_{in} \delta_{jm}
    \right) \varepsilon_{mn}
&
&\text{for some }A, B, C\in\mathbb{R}
\notag \\
&= A \delta_{ij} \varepsilon_{mm} + B\varepsilon_{ij} + C\varepsilon_{ji}
\notag \\
&= A \delta_{ij} \varepsilon_{mm} + \left( B+C \right)\varepsilon_{ji}
\notag \\
&= 2 \mu \varepsilon_{ij} + \lambda\delta_{ij}\nabla\cdot{}u
\end{align}
where $\mu=\frac{1}{2}\left( B + C \right)$ is the viscosity
and $\lambda=A$ is the second viscosity.
Reverting to direct notation we have
\begin{align}
\tau
&= 2 \mu \varepsilon + \lambda \left( \nabla\cdot{}u \right) I
\notag \\
\label{eq:taunewt}
&=   \mu \left( \nabla{}u + \trans{\nabla{}u} \right)
  + \lambda \left( \nabla\cdot{}u \right) I
\end{align}

\subsubsection{Stokes' hypothesis}

We assume the second viscosity $\lambda=-\frac{2}{3}\mu$.  The assumption is
valid for most circumstances~\cite{GadelHak1995}.  However, because we
anticipate separately maintaining $\lambda$ being useful, we will not combine
$\mu$ and $\lambda$ terms in the model.

\subsubsection{Power law viscosity}

We assume that viscosity varies only with temperature according to
\begin{align}
\label{eq:powerlawviscosity}
\frac{\mu}{\mu_{0}}=\left(\frac{T}{T_{0}}\right)^{\beta}
\end{align}
where $\mu_{0}$ and $T_{0}$ are suitable reference values.  This
relationship models air well for temperatures up to several thousand
degrees Kelvin~\cite{NASA-TR-R-132}.

\subsubsection{Fourier's equation}

We neglect the transport of energy by molecular diffusion and radiative
heat transfer.  We seek a relation between the surface heat flux $q_{s}$
and the temperature $T$.  The principle of frame indifference implies
we may only use the temperature gradient so that
\begin{align}
  \label{eq:fouriertensorlaw}
  q_{s} &= \underline{\kappa} \cdot \nabla{} T
\end{align}
where $\underline{\kappa}$ is a thermal conductivity tensor.
Consistent with our assumption that $\tau$ is isotropic, we assume
$\underline{\kappa}$ is isotropic to obtain
\begin{align}
  \label{eq:fourierlaw}
  q_{s} &= - \kappa \nabla{} T
\end{align}
where $\kappa$ is the scalar thermal conductivity.  We introduce the
negative sign so that heat flows from hot to cold when $\kappa>0$.

\subsubsection{Constant Prandtl number}

We assume the Prandtl number $\Prandtl = \frac{\mu{}C_{p}}{\kappa}$ is constant.
Because $C_{p}$ is constant the ratio $\frac{\mu}{\kappa}$ must be
constant.  The viscosity and thermal conductivity must either grow at
identical rates or they must grow according to an inverse relationship.
The latter is not observed in practice for our class of fluids, and
so we assume
\begin{align}
  \frac{\mu}{\mu_{0}} = \frac{\kappa}{\kappa_{0}}
  .
  \label{eq:mukappa}
\end{align}

\subsubsection{Forcing terms}

We add arbitrary space- and time-varying forcing to the continuity,
momentum, and energy equations using a continuity source term $c_{s}$,
a body force density $f_{b}$, and a body heating density $q_{b}$,
respectively.  These terms are provided to facilitate using the method
of manufactured solutions for implementation verification.

\subsection{Dimensional equations}

By combining the conservation laws with our constitutive relations
and assumptions, we arrive at the dimensional equations
\begin{subequations}\label{eq:dimensionalmodel}
\begin{align}
  \label{eq:dim_continuity}
  \frac{\partial}{\partial{}t}\rho
&=
  - \nabla\cdot\rho{}u
  + c_{s}
  \\
  \label{eq:dim_momentum}
  \frac{\partial{}}{\partial{}t}\rho{}u
&=
  - \nabla\cdot(u\otimes{}\rho{}u)
  -\nabla{} p
  + \nabla\cdot{} \tau
  + \rho{}f_{b}
  \\
  \label{eq:dim_energy}
  \frac{\partial}{\partial{}t} \rho{}\tilde{e}
&=
  - \nabla\cdot{}\rho{}\tilde{e}u
  + \nabla\cdot{} \frac{\kappa_{0}}{\mu_{0}} \mu \nabla{} T
  - \nabla\cdot{} p u
  + \nabla\cdot{}\tau{} u
  + \rho{}f_{b} \cdot{} u
  + \rho{}q_{b}
\intertext{
  where terms in the right hand side make use of
}
  \label{eq:dim_pressure}
  p &=   \left(\gamma-1\right)\left(\rho{}\tilde{e}
       - \rho\frac{u\cdot{}u}{2} \right)
  \\
  \label{eq:dim_temperature}
  T &= \frac{p}{\rho{}R}
  \\
  \label{eq:dim_viscosity}
  \mu &= \mu_{0} \left( \frac{T}{T_{0}} \right)^{\beta}
  \\
  \label{eq:dim_secondviscosity}
  \lambda &= - \frac{2}{3} \mu
  \\
  \label{eq:dim_viscousstress}
  \tau &=   \mu \left( \nabla{}u + \trans{\nabla{}u} \right)
          + \lambda \left( \nabla\cdot{}u \right) I
  .
\end{align}
\end{subequations}

\subsection{Nondimensionalization}

\subsubsection{Introduction of nondimensional variables}

We rewrite the dimensional equations using nondimensional variables
combined with arbitrary reference quantities.  For each dimensional
quantity in the dimensional model we introduce a nondimensional variable
or operator denoted by a superscript star, e.g. $\nabla^{*}$.

We introduce $t^{*}=\frac{t}{t_{0}}$ and $x^{*}=\frac{x}{l_{0}}$ for some
reference $t_{0}$ and $l_{0}$.  This induces the following relationships:
\begin{align}
  \frac{\partial{}}{\partial{}t}
  &=
  \frac{\partial{}}{\partial{}t^{*}}
  \frac{\partial{}t^{*}}{\partial{}t}
  =
  \frac{1}{t_{0}}\frac{\partial}{\partial{}t^{*}}
  &
  \frac{\partial{}}{\partial{}x}
  &=
  \frac{\partial{}}{\partial{}x^{*}}
  \frac{\partial{}x^{*}}{\partial{}x}
  =
  \frac{1}{l_{0}}\frac{\partial}{\partial{}x^{*}}
  &
  \nabla
  &=
  \hat{e}_{i} \frac{\partial{}}{\partial{}x_{i}}
  =
  \hat{e}_{i} \frac{1}{l_{0}} \frac{\partial}{\partial{}x^{*}_{i}}
  =
  \frac{1}{l_{0}} \nabla^{*}
  \label{eq:nondim_derivops}
\end{align}

We introduce more nondimensional quantities (e.g. $\rho^{*} =
\frac{\rho}{\rho_{0}}$) and use them to reexpress the model
\begin{subequations}\label{eq:dimwithref_model}
\begin{align}
  \label{eq:dimwithref_continuity}
  \frac{\rho_{0}}{t_{0}} \frac{\partial}{\partial{}t^{*}}\rho^{*}
&=
  - \frac{\rho_{0}u_{0}}{l_{0}} \nabla^{*}\cdot\rho^{*}u^{*}
  + c_{0} c_{s}^{*}
  \\
  \label{eq:dimwithref_momentum}
  \frac{\rho_{0}u_{0}}{t_{0}} \frac{\partial{}}{\partial{}t^{*}}\rho^{*}u^{*}
&=
  - \frac{\rho_{0}u_{0}^{2}}{l_{0}}
    \nabla^{*}\cdot(u^{*}\otimes{}\rho^{*}u^{*})
  - \frac{p_{0}}{l_{0}} \nabla^{*} p^{*}
  + \frac{\tau_{0}}{l_{0}} \nabla^{*}\cdot{} \tau^{*}
  + \rho_{0} f_{0} \rho^{*}f_{b}^{*}
  \\
  \label{eq:dimwithref_energy}
  \frac{\rho_{0}\tilde{e}_{0}}{t_{0}}
  \frac{\partial}{\partial{}t^{*}} \rho^{*}\tilde{e}^{*}
&=
  - \frac{\rho_{0}\tilde{e}_{0}u_{0}}{l_{0}} \nabla^{*} \cdot{}\rho^{*}\tilde{e}^{*}u^{*}
  + \frac{\kappa_{0}T_{0}}{l_{0}^{2}}
    \nabla^{*}\cdot{} \mu^{*} \nabla^{*} T^{*}
  - \frac{p_{0}u_{0}}{l_{0}} \nabla^{*}\cdot{} p^{*} u^{*}
\notag\\
&\quad{}+ \frac{\tau_{0}u_{0}}{l_{0}} \nabla^{*}\cdot{}\tau^{*} u^{*}
  + \rho_{0}f_{0}u_{0} \rho^{*} f_{b}^{*} \cdot{} u^{*}
  + \rho_{0}q_{0} \rho^{*} q_{b}^{*}
\intertext{
  where terms in the right hand side are computed using
}
  \label{eq:dimwithref_pressure}
  p^{*} &= \frac{\gamma-1}{p_{0}} \left(
        \rho_{0}\tilde{e}_{0}\rho^{*}\tilde{e}^{*}
      - \rho_{0}u_{0}^{2}\,\rho^{*}\frac{u^{*}\cdot{}u^{*}}{2}
  \right)
  \\
  \label{eq:dimwithref_temperature}
  T^{*} &= \frac{p_{0}p^{*}}{\rho_{0}RT_{0}\,\rho^{*}}
  \\
  \label{eq:dimwithref_viscosity}
  \mu^{*} &= \left( T^{*} \right)^{\beta}
  \\
  \label{eq:dimwithref_secondviscosity}
  \lambda^{*} &= - \frac{2}{3} \mu^{*}
  \\
  \label{eq:dimwithref_viscousstress}
  \tau^{*} &= \frac{\mu_{0}u_{0}}{l_{0} \tau_{0}} \left[
      \mu^{*} \left( \nabla^{*}u^{*} + \trans{\nabla^{*}u^{*}} \right)
      + \lambda^{*} \left( \nabla^{*}\cdot{}u^{*} \right) I
    \right]
  .
\end{align}
\end{subequations}
Notice that $\lambda$ has been nondimensionalized using $\mu_{0}$.
At this stage, we have many more reference quantities than the underlying
dimensions warrant.

\subsubsection{Reference quantity selections}

We choose a reference length $l_{0}$, temperature $T_{0}$, and density
$\rho_{0}$.  These selections fix all other dimensional reference
quantities:
\begin{align}
  a_{0} &= \sqrt{\gamma{}RT_{0}}
  &
  u_{0} &= a_{0}
  &
  \tilde{e}_{0} &= a_{0}^{2}
  &
  t_{0} &= \frac{l_{0}}{a_{0}}
  &
  p_{0} &= \rho_{0} a_{0}^{2}
  &
  \tau_{0} &= \frac{\mu_{0}a_{0}}{l_{0}}
  &
  c_{0} &= \frac{\rho_{0}}{t_{0}}
  &
  f_{0} &= \frac{a_{0}^{2}}{l_{0}}
  &
  q_{0} &= \frac{a_{0}^{3}}{l_{0}}
\end{align}
Because we assume viscosity varies only with temperature,
$\mu_{0}=\mu\!\left( T_{0} \right)$ is fixed by $T_{0}$.
Because we assume a constant Prandtl number, $\kappa_{0}=\kappa\!\left(
\mu\!\left( T_{0} \right) \right)$ is also fixed by $T_{0}$.

\subsubsection{Nondimensional equations}
\label{nondim_equations}

We employ the reference quantity relationships after
multiplying the continuity, momentum, and energy equations by
$\frac{t_{0}}{\rho_{0}}$, $\frac{l_{0}}{\rho_{0}a_{0}^{2}}$, and
$\frac{t_{0}}{\rho_{0}\tilde{e}_{0}}$ respectively.  Henceforth
we suppress the superscript star notation because all terms are
dimensionless.  We arrive at the following nondimensional equations:
\begin{subequations}
\begin{align}
  \label{eq:nondim_continuity}
  \frac{\partial}{\partial{}t}\rho{}
&=
  - \nabla\cdot\rho{}u
  + c_s
  \\
  \label{eq:nondim_momentum}
  \frac{\partial}{\partial{}t}\rho{}u
&=
  - \nabla\cdot(u\otimes\rho{}u)
  - \nabla{} p
  + \frac{1}{\Reynolds} \nabla\cdot\tau
  + \rho{}f_{b}
  \\
  \label{eq:nondim_energy}
  \frac{\partial}{\partial{}t} \rho{}\tilde{e}
&=
  - \nabla\cdot\rho{}\tilde{e}u
  + \frac{1}{\Reynolds\,\Prandtl\,\left( \gamma - 1 \right)}
    \nabla\cdot\mu\nabla{} T
  - \nabla\cdot{} p u
  + \frac{1}{\Reynolds} \nabla\cdot\tau{} u
  + \rho{} f_{b} \cdot{} u
  + \rho{} q_{b}
\intertext{
  where $\Reynolds=\frac{\rho_{0}u_{0}l_{0}}{\mu_{0}}$ and
  $\Prandtl=\frac{\mu_{0}C_{p}}{\kappa_{0}}$.  The nondimensional quantities
  appearing above are given by:
}
  \label{eq:nondim_pressure}
  p &= \left(\gamma-1\right) \left(
    \rho{}\tilde{e} - \rho{}\frac{u\cdot{}u}{2}
  \right)
  \\
  \label{eq:nondim_temperature}
  T &= \gamma{} \frac{p}{\rho}
  \\
  \label{eq:nondim_viscosity}
  \mu &= T^{\beta}
  \\
  \label{eq:nondim_secondviscosity}
  \lambda &= -\frac{2}{3}\mu
  \\
  \label{eq:nondim_viscousstress}
  \tau &=  \mu\left(\nabla{}u+\trans{\nabla{}u}\right)
         + \lambda\left(\nabla\cdot{}u\right) I
\end{align}
\end{subequations}



\section{Discretization}
\label{sec:discretization}

\subsection{Spatial discretization}

To begin spatially discretizing the continuous nonlinear system
\begin{align}
  \partial_t u &= N\!\left(u\right)
\intertext{
  on the spatial domain
  $[0,L_x]\times{}[0,L_y]\times{}[0,L_z]$,
  we introduce its finite dimensional analog
}
  \partial_t u^h &= N\!\left(u^h\right) + R^h
  \label{eq:discrete_system_with_residual}
\end{align}
where continuous $u = u\!\left(x,y,z,t\right)$ has been replaced by discrete
$u^h = u^h\!\left(x,y,z,t\right)$ with $N_x\times{}N_y\times{}N_z$ degrees of
freedom.  Here, $R^h$ is the discretization error that arises because the
discrete solution cannot satisfy the continuous equations everywhere in space.
We select Fourier expansions in the periodic $x$ and $z$ directions and a
B-spline expansion in the wall-normal $y$ direction.  That is,
\begin{align}
u^h(x,y,z,t)
&=
  \sum_{l=0}^{N_y}
  \sum_{m=-\frac{N_x}{2}+1}^{\frac{N_x}{2}}
  \sum_{n=-\frac{N_z}{2}+1}^{\frac{N_z}{2}}
  \hat{u}_{l,m,n}(t)
  B_l(y)
  e^{\ii\frac{2\pi{}m}{L_x}x}
  e^{\ii\frac{2\pi{}n}{L_z}z}
  \\
&=
  \sum_{l}\sum_{k_x}\sum_{k_z}
  \hat{u}_{l,m,n}(t)B_l(y)e^{\ii k_x x}e^{\ii k_z z}
  \label{eq:u_h_expansion}
\end{align}
where $k_x = 2\pi{}m/L_x$, $k_z = 2\pi{}n/L_z$, and $B_l(y)$ represents
the fixed order B-spline basis functions.

Now, within the method of weighted residuals framework, we choose a mixed
Galerkin/collocation approach employing the $L^2$ inner product and test
``functions'' like $\delta(y-y_i) e^{\ii k_x' x}e^{\ii k_z' z}$ for fixed
collocation points $y_i$.  We catalog three relevant results
\begin{align}
   \int_0^{L_y} \varphi(y) \, \delta(y-y_i) \,d\!y
&= \varphi(y_i),
&
   \int_0^{L_x} e^{\ii k_x x} e^{-\ii k_x' x} \,d\!x
&= L_x \delta_{k_x k_x'}, \text{ and}
&
   \int_0^{L_z} e^{\ii k_z z} e^{-\ii k_z' z} \,d\!z
&= L_z \delta_{k_z k_z'}
\end{align}
where the inner product's conjugate operation is accounted for by introducing a
negative sign into the latter two exponentials.  We force the weighted residual
to be zero in the sense that
\begin{align}
 \int_0^{L_y}\!\!\int_0^{L_x}\!\!\int_0^{L_z}
 R^h\!\left(x,y,z\right) \delta(y-y_i) e^{-\ii k_x' x}e^{-\ii k_z' z}
 \,d\!z \,d\!x \,d\!y
 &=
 \int_0^{L_x}\!\!\int_0^{L_z}
 R^h\!\left(x,y_i,z\right) e^{-\ii k_x' x}e^{-\ii k_z' z}
 \,d\!z \,d\!x
 =
 0
\end{align}
holds for all $y_i$, $k_x'$, and $k_z'$.  Inserting \eqref{eq:u_h_expansion}
into \eqref{eq:discrete_system_with_residual}, testing with our test functions,
and simplifying each side separately we obtain the following:
\begin{align}
  \int_{0}^{L_y}\!\!\int_{0}^{L_x}\!\!\int_{0}^{L_z}
 &\partial_t
  \left(
    \sum_{l}\sum_{k_x}\sum_{k_z}
    \hat{u}_{l,m,n}(t)B_l(y)e^{\ii k_x x}e^{\ii k_z z}
  \right)
  \left(
    \delta(y-y_i) e^{-\ii k_x' x}e^{-\ii k_z' z}
  \right)
  \, dz \, dx \, dy
\\
  &=
  L_x L_z \sum_{l} B_l(y_i)
  \partial_t \hat{u}_{l,m,n}(t)
\\
  \int_{0}^{L_y}\!\!\int_{0}^{L_x}\!\!\int_{0}^{L_z}
 &N\left(
    \sum_{l}\sum_{k_x}\sum_{k_z}
    \hat{u}_{l,m,n}(t)B_l(y)e^{\ii k_x x}e^{\ii k_z z}
  \right)
  \left(
    \delta(y-y_i) e^{-\ii k_x' x}e^{-\ii k_z' z}
  \right)
  \, dz \, dx \, dy
\\
  &=
  \int_{0}^{L_x}\!\!\int_{0}^{L_z}
  N\left(
    \sum_{k_x}\sum_{k_z}
    \left(
      \sum_{l} B_l(y_i)
      \hat{u}_{l,m,n}(t)
    \right)
    e^{\ii k_x x}e^{\ii k_z z}
  \right)
  \left(
    e^{-\ii k_x' x}e^{-\ii k_z' z}
  \right)
  \, dz \, dx
\intertext{
  Reequating the two sides and rearranging gives
}
  \sum_{l} B_l(y_i)
  \partial_t \hat{u}_{l,m,n}(t)
&=
  \frac{1}{L_x L_z}
  \int_{0}^{L_x}\!\!\int_{0}^{L_z}
  N\left(
    \sum_{k_x}\sum_{k_z}
    \left(
      \sum_{l} B_l(y_i)
      \hat{u}_{l,m,n}(t)
    \right)
    e^{\ii k_x x}e^{\ii k_z z}
  \right)
  \left(
    e^{-\ii k_x' x}e^{-\ii k_z' z}
  \right)
  \, dz \, dx
\\
&\approx
  \frac{1}{L_x L_z}
  \sum_{k_x'} \sum_{k_z'}
  N\left(
    \sum_{k_x}\sum_{k_z}
    \left(
      \sum_{l} B_l(y_i)
      \hat{u}_{l,m,n}(t)
    \right)
    e^{\ii k_x x}e^{\ii k_z z}
  \right)
  \left(
    e^{-\ii k_x' x}e^{-\ii k_z' z}
  \right)
  \label{eq:spatial_discretization}
\end{align}
\nopagebreak
where we have introduced quadrature error by approximating two integrals using
finite sums.  This error can be mitigated via an appropriate dealiasing
technique.  We are left with $N_x\times{}N_z$ time-dependent systems containing
$N_y$ equations coupled in the $x$ and $z$ directions only through Fourier
transform-like operations and the requirements of the nonlinear operator $N$.
% FIXME Need dealiasing reference!

Calling $\hat{u}_{l,m,n}(t)$ the wave space coefficients of the
solution at some time $t$, the right hand side may be efficiently computed by
\begin{enumerate}
 \item performing $m\times{}n$ matrix-vector products
       $\sum_{l} B_l(y_i) \hat{u}_{l,m,n}(t)$,
 \item using an inverse fast Fourier transform across
       the $x$ and $z$ directions to convert state information from wave space
       to physical space,
 \item applying the nonlinear operator $N$ in physical space, and
 \item using a forward fast Fourier transform across the $x$ and $z$
       directions to convert information from physical space to wave space.
\end{enumerate}
Note that the inverse Fourier transform is not normalized while the forward
transform must be normalized.  Note also that the left hand side
contains a mass matrix arising from the B-spline basis and collocation details.
We retain it on the same side as the time derivative in anticipation of the
time discretization scheme.

\subsection{Time discretization}


\section{Numerical considerations}

Here we take the complete mathematical model from section \ref{seq:derivation}
and put it into the form which we will compute per section
\ref{sec:discretization}.  Though less clean in appearance, this section's
equations will better reflect the spectral implementation details used in
Suzerain than those given in the previous section.  We continue to use
$\nabla$-notation instead of switching to Cartesian index notation in
anticipation of $\nabla$ being decomposed into slow- and fast-growth
contributions and/or needing to account for curvature in the domain.

\subsection{Convective derivative operator form}

We choose to use the conservative form of the convective derivative operator,
$\nabla\cdot\left(u\otimes{}\rho{}u\right)$, instead of the skew-symmetric
form, $\frac{1}{2}u\cdot\nabla{}\rho{}u +
\frac{1}{2}\nabla\cdot{}u\otimes{}\rho{}u$.  The former is simpler to compute,
retains the conservative nature of the equations, and behaves comparably to the
latter in the incompressible case when aliasing errors are
removed~\cite{Zang1991Rotation}.  This choice may need to be revisited as the
wall-normal direction is not dealiased.

\subsection{State variable selection}
\label{state_variable_selection}

We use nondimensional density $\rho$, momentum $m=\rho{}u$, and total energy
$e=\rho{}\tilde{e}$ as the state variables for our computations.  Though it
eliminates division and potentially allows for fully dealiased calculations, we
do not use specific density $\sigma=1/\rho$ because it requires using a
nonconservative mass equation.  When rewritten using the state variables
the equations in section~\ref{nondim_equations} become
\begin{subequations}
\begin{align}
  \label{eq:state_continuity}
  \frac{\partial}{\partial{}t}\rho{}
&=
  - \nabla\cdot{}m
  + c_s
  \\
  \label{eq:state_momentum}
  \frac{\partial}{\partial{}t}m
&=
  - \nabla\cdot\left(\frac{m}{\rho}\otimes{}m\right)
  - \nabla{} p
  + \frac{1}{\Reynolds} \nabla\cdot\tau
  + \rho{}f_{b}
  \\
  \label{eq:state_energy}
  \frac{\partial}{\partial{}t} e
&=
  - \nabla\cdot{}\left(e + p\right)\frac{m}{\rho}
  + \frac{1}{\Reynolds\,\Prandtl\,\left( \gamma - 1 \right)}
    \nabla\cdot\mu\nabla{} T
  + \frac{1}{\Reynolds} \nabla\cdot\tau{}\frac{m}{\rho}
  + f_{b} \cdot{} m
  + \rho{} q_{b}
\intertext{
  where the non-state quantities are fixed by
}
  \label{eq:state_pressure}
  p &= \left(\gamma-1\right) \left(
    e - \frac{m^2}{2\rho}
  \right)
  \\
  \label{eq:state_temperature}
  T &= \gamma{} \frac{p}{\rho}
  \\
  \label{eq:state_viscosity}
  \mu &= T^{\beta}
  \\
  \label{eq:state_secondviscosity}
  \lambda &= - \frac{2}{3} \mu
  \\
  \label{eq:state_viscousstress}
  \tau &= 2 \mu \symmetricpart{\nabla{}\frac{m}{\rho}}
        + \lambda\left(\nabla\cdot{}\frac{m}{\rho}\right) I
\end{align}
\end{subequations}
where we have employed the notation $m^2=m\cdot{}m$ and
$\symmetricpart{A}=\frac{1}{2}\left(A+\trans{A}\right)$.

\subsection{Communications overhead}

Suzerain performs time advancement in wave space but must compute nonlinear
terms in physical space.  The communications and computation cost required to
convert state data from wave space to physical space or vice versa is very
high.  Consequently, we transform back and forth only once per time integration
substep.  This implies that we must be able to compute derived quantity
derivatives using state quantity derivatives.

\subsection{Velocity derivative expansions}
\label{velocity_derivative_expansions}

We expand the necessary velocity derivatives into a combination of terms each
containing derivative operators applied only to state quantities:
\begin{subequations}
\begin{align}
  \nabla\cdot\frac{m}{\rho}
  &=
  \rho^{-1}\left[ \nabla\cdot{}m - \rho^{-1}m\cdot\nabla\rho \right]
\\
  \nabla{}\frac{m}{\rho}
  &=
  \rho^{-1}\left[ \nabla{}m - \rho^{-1}{m}\otimes\nabla\rho  \right]
\\
  \symmetricpart{\nabla\frac{m}{\rho}}
  &=
  \rho^{-1}\left[
      \symmetricpart{\nabla{}m}
    - \symmetricpart{\rho^{-1}m\otimes\nabla\rho}
  \right]
\\
  \Delta\frac{m}{\rho}
  &=
 \rho^{-1}\left[
      \Delta{}m
    + \rho^{-1}\left[
          \left(
              2\rho^{-1}\left(\nabla\rho\right)^{2}
            - \Delta\rho
          \right) {m}
        - 2 \left(\nabla{}m\right)\nabla\rho
      \right]
 \right]
\\
  \nabla\nabla\cdot\frac{m}{\rho}
  &=
  \rho^{-1}\left[
        \nabla\nabla\cdot{}m
      + \rho^{-1}\left[
            \left(2\rho^{-1}\nabla\rho\cdot{}m-\nabla\cdot{}m\right)\nabla\rho
          - \left(\nabla\nabla\rho\right)m
          - \trans{\nabla{}m}\nabla\rho
        \right]
  \right]
\end{align}
\end{subequations}

We note some relationships amongst the information appearing in such
derivatives:
\begin{align}
  \Delta\rho
  &=
  \trace\left( \nabla\nabla\rho \right)
&
  \nabla\cdot{}m
  &=
  \trace\left(\nabla{}m\right)
  =
  \trace\symmetricpart{\nabla\frac{m}{\rho}}
\end{align}

\subsection{Separation of first and second derivative operators}
\label{separate_first_section_deriv}

Suzerain uses a B-spline basis in the wall normal direction.  Unlike a Fourier
basis, for B-splines the repeated application of a discrete first derivative
operator gives a result that differs significantly from applying a discrete
second derivative operator.  In particular, repeated first differentiation
severely abates high frequency modes (see figures 2 and 3 in ~\cite{Kwok2001}).

Second differentiation enters equations~\eqref{eq:state_continuity},
\eqref{eq:state_momentum}, and~\eqref{eq:state_energy} through the terms
$\nabla\cdot\tau$, $\nabla\cdot\tau\frac{m}{\rho}$, and
$\nabla\cdot\mu\nabla{}T$.  We wish to compute these terms in a way that keeps
first and second derivative applications wholly separate.  Doing so will help
ensure that these three terms have the appropriate diffusive effects on high
frequency content.

We expand the three mixed order, nonlinear terms:
\begin{subequations}
\begin{align}
  \nabla\cdot\tau
  &=
    2 \symmetricpart{\nabla\frac{m}{\rho}}\nabla\mu
  + \mu \Delta\frac{m}{\rho}
  + \left(\mu+\lambda\right)\nabla\nabla\cdot\frac{m}{\rho}
  + \left(\nabla\cdot\frac{m}{\rho}\right)\nabla\lambda
\\
  \nabla\cdot\tau{}\frac{m}{\rho}
  &=
    \frac{m}{\rho}\cdot\left(\nabla\cdot\tau\right)
  + \trace\left( \tau\,\nabla\frac{m}{\rho} \right)
\\
  \nabla\cdot\mu\nabla{}T
  &=
    \nabla\mu\cdot\nabla{}T
  + \mu \Delta{}T
\end{align}
\end{subequations}
Many of these term contains non-state quantity derivatives which we also
expand:
\begin{subequations}
\begin{align}
  \nabla{}p &= (\gamma-1)\left[
        \nabla{}e
      + \frac{1}{2}\rho^{-2} m^{2} \nabla\rho
      - \rho^{-1} \trans{\nabla{}m}m
  \right]
\\
  \nabla{}T &= \gamma\rho^{-1}\nabla{}p
             - \gamma\rho^{-2} p \nabla\rho
\\
  \nabla\mu &= \beta{}T^{\beta-1}\nabla{}T
\\
  \nabla\lambda &= -\frac{2}{3}\nabla\mu
\\
  \Delta{}p
  &=
  \left(\gamma-1\right)\left[
      \Delta{}e
      - \rho^{-1}\left[
            \trace\left( \trans{\nabla{}m}\nabla{}m \right)
          + m\cdot\Delta{}m
\right.\right. \notag\\ &\qquad\qquad\qquad\qquad \left.\left. % LINE BREAK
        {}- \rho^{-1}\left[
                2\trans{\nabla{}m}m\cdot\nabla{}\rho
              + \frac{1}{2} m^2 \Delta\rho
              - \rho^{-1} m^2 \left(\nabla\rho\right)^{2}
          \right]
      \right]
  \right]
\\
  \Delta{}T
  &=
  \gamma\rho^{-1}\left[
        \Delta{}p
      - \rho^{-1}\left[
            p\Delta{}\rho
          + 2\nabla{}\rho\cdot\left( \nabla{}p - \rho^{-1}p\nabla\rho \right)
      \right]
  \right]
\end{align}
\end{subequations}

Though we could have found these expressions for only the wall-normal
direction, writing them for the complete $\nabla$ operator allows us to reuse
them later.

\subsection{Fully explicit scheme cost tabulation}

Though Suzerain uses a hybrid implicit/explicit time stepping scheme and a
Fourier basis in the streamwise and spanwise directions where repeated first
differentiation is acceptable, it is useful to examine the communication costs
for purely a explicit time stepper when we do not mix derivative orders.

Using the information in sections~\ref{velocity_derivative_expansions}
and~\ref{separate_first_section_deriv} we tabulate in
table~\ref{tab:nofirstderivnonlinearcost} the specific state variable
derivatives necessary to compute each mixed-derivative nonlinear term and all
of its contributions.  From this table and the equations appearing in
section~\ref{state_variable_selection}, a fully explicit timestepping approach
could compute a single substep at the cost of converting 33 scalar fields from
wave space to physical space, forming 5 scalars representing the right hand
sides of equations~\eqref{eq:state_continuity}--\eqref{eq:state_energy}, and
converting 5 scalar fields back to wave space.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{table}[p]
\centering
\vspace{1em}
\renewcommand{\arraystretch}{1.40}   % Adds whitespace between rows
\newcommand{\cm}{\checkmark}         % For brevity in the table details
\newcommand{\cd}{\ensuremath{\cdot}} % For brevity in the table details
\begin{tabular}{r|cccc|cccccc|ccc|r}
% 001 & 002 & 003 & 004 & 005 & 006 & 007 & 008 & 009 & 011 & 012 & 013 & 014
&   1 &   3 &   1 &   6 &   3 &   1 &   6 &   9 &   3 &   3 &   1 &   3 &   1
\\
& $\rho$                                              % 01
& $\nabla\rho$                                        % 02
& $\Delta\rho$                                        % 03
& $\nabla\nabla\rho$                                  % 04
& $m$                                                 % 05
& $\nabla\cdot{}m$                                    % 06
& $\symmetricpart{\nabla{}m}$                         % 07
& $\nabla{}m$                                         % 08
& $\Delta{}m$                                         % 09
& $\nabla\nabla\cdot{}m$                              % 11
& $e$                                                 % 12
& $\nabla{}e$                                         % 13
& $\Delta{}e$                                         % 14
\\ \hline
$\nabla\cdot\frac{m}{\rho}$
% 001 & 002 & 003 & 004 & 005 & 006 & 007 & 008 & 009 & 011 & 012 & 013 & 014
& \cm & \cm &     &     & \cm & \cm &     &     &     &     &     &     &
& 8 \\
$\nabla\frac{m}{\rho}$
% 001 & 002 & 003 & 004 & 005 & 006 & 007 & 008 & 009 & 011 & 012 & 013 & 014
& \cm & \cm &     &     & \cm &     &     & \cm &     &     &     &     &
& 16 \\
$\symmetricpart{\nabla\frac{m}{\rho}}$
% 001 & 002 & 003 & 004 & 005 & 006 & 007 & 008 & 009 & 011 & 012 & 013 & 014
& \cm & \cm &     &     & \cm &     & \cm &     &     &     &     &     &
& 13 \\
$\Delta\frac{m}{\rho}$
% 001 & 002 & 003 & 004 & 005 & 006 & 007 & 008 & 009 & 011 & 012 & 013 & 014
& \cm & \cm & \cm &     & \cm &     &     & \cm & \cm &     &     &     &
& 20 \\
$\nabla\nabla\cdot\frac{m}{\rho}$
% 001 & 002 & 003 & 004 & 005 & 006 & 007 & 008 & 009 & 011 & 012 & 013 & 014
& \cm & \cm &     & \cm & \cm & \cd &     & \cm &     & \cm &     &     &
& 25 \\[1.5em]
$p$, $T$, $\mu$, $\lambda$
% 001 & 002 & 003 & 004 & 005 & 006 & 007 & 008 & 009 & 011 & 012 & 013 & 014
& \cm &     &     &     & \cm &     &     &     &     &     & \cm &     &
& 5 \\
$\nabla{}p$, $\nabla{}T$, $\nabla\mu$, $\nabla\lambda$
% 001 & 002 & 003 & 004 & 005 & 006 & 007 & 008 & 009 & 011 & 012 & 013 & 014
& \cm & \cm &     &     & \cm &     &     & \cm &     &     & \cm & \cm &
& 20 \\
$\Delta{}p$
% 001 & 002 & 003 & 004 & 005 & 006 & 007 & 008 & 009 & 011 & 012 & 013 & 014
& \cm & \cm & \cm &     & \cm &     &     & \cm & \cm &     &     &     & \cm
& 21 \\
$\Delta{}T$
% 001 & 002 & 003 & 004 & 005 & 006 & 007 & 008 & 009 & 011 & 012 & 013 & 014
& \cm & \cm & \cm &     & \cm &     &     & \cm & \cm &     & \cm & \cm & \cm
& 25 \\[1.5em]
$\tau$
% 001 & 002 & 003 & 004 & 005 & 006 & 007 & 008 & 009 & 011 & 012 & 013 & 014
& \cm & \cm &     &     & \cm & \cd & \cm &     &     &     & \cm &     &
& 14 \\[1.5em]
$\symmetricpart{\nabla\frac{m}{\rho}} \nabla\mu$
% 001 & 002 & 003 & 004 & 005 & 006 & 007 & 008 & 009 & 011 & 012 & 013 & 014
& \cm & \cm &     &     & \cm &     & \cd & \cm &     &     & \cm & \cm &
& 20 \\
$\mu\Delta\frac{m}{\rho}$
% 001 & 002 & 003 & 004 & 005 & 006 & 007 & 008 & 009 & 011 & 012 & 013 & 014
& \cm & \cm & \cm &     & \cm &     &     & \cm & \cm &     & \cm &     &
& 21 \\
$\left(\mu+\lambda\right)\nabla\nabla\cdot\frac{m}{\rho}$
% 001 & 002 & 003 & 004 & 005 & 006 & 007 & 008 & 009 & 011 & 012 & 013 & 014
& \cm & \cm &     & \cm & \cm & \cd &     & \cm &     & \cm & \cm &     &
& 26 \\
$\left(\nabla\cdot\frac{m}{\rho}\right)\nabla\lambda$
% 001 & 002 & 003 & 004 & 005 & 006 & 007 & 008 & 009 & 011 & 012 & 013 & 014
& \cm & \cm &     &     & \cm & \cd &     & \cm &     &     & \cm & \cm &
& 20 \\
$\nabla\cdot\tau$
% 001 & 002 & 003 & 004 & 005 & 006 & 007 & 008 & 009 & 011 & 012 & 013 & 014
& \cm & \cm & \cd & \cm & \cm & \cd & \cd & \cm & \cm & \cm & \cm & \cm &
& 32 \\[1.5em]
$\frac{m}{\rho}\cdot\left(\nabla\cdot\tau\right)$
% 001 & 002 & 003 & 004 & 005 & 006 & 007 & 008 & 009 & 011 & 012 & 013 & 014
& \cm & \cm & \cd & \cm & \cm & \cd & \cd & \cm & \cm & \cm & \cm & \cm &
& 32 \\
$\trace\left(\tau\nabla\frac{m}{\rho}\right)$
% 001 & 002 & 003 & 004 & 005 & 006 & 007 & 008 & 009 & 011 & 012 & 013 & 014
& \cm & \cm &     &     & \cm & \cd & \cd & \cm &     &     & \cm &     &
& 20 \\
$\nabla\cdot\tau\frac{m}{\rho}$
% 001 & 002 & 003 & 004 & 005 & 006 & 007 & 008 & 009 & 011 & 012 & 013 & 014
& \cm & \cm & \cd & \cm & \cm & \cd & \cd & \cm & \cm & \cm & \cm & \cm &
& 32 \\[1.5em]
$\nabla\mu\cdot\nabla{}T$
% 001 & 002 & 003 & 004 & 005 & 006 & 007 & 008 & 009 & 011 & 012 & 013 & 014
& \cm & \cm &     &     & \cm &     &     & \cm &     &     & \cm & \cm &
& 20 \\
$\mu\Delta{}T$
% 001 & 002 & 003 & 004 & 005 & 006 & 007 & 008 & 009 & 011 & 012 & 013 & 014
& \cm & \cm & \cm &     & \cm &     &     & \cm & \cm &     & \cm & \cm & \cm
& 25 \\
$\nabla\cdot\mu\nabla{}T$
% 001 & 002 & 003 & 004 & 005 & 006 & 007 & 008 & 009 & 011 & 012 & 013 & 014
& \cm & \cm & \cm &     & \cm &     &     & \cm & \cm &     & \cm & \cm & \cm
& 25
\end{tabular}
\vspace{1em}
\caption{
    State variable derivatives and the relative computational cost required to
    completely compute quantities in physical space without using repeated
    first derivative applications.  A check (\checkmark) indicates that a
    quantity is required to compute the given term.  A dot ($\cdot$) indicates
    the quantity is required but it can be computed from other required
    quantities.  Costs are given relative to the cost of transforming a single
    scalar field from wave space to physical space and do not include floating
    point operations. The total cost for each term is found in the rightmost
    column of the table.
}
\label{tab:nofirstderivnonlinearcost}
\end{table}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Linearization of second order viscous terms}

Suzerain uses a hybrid implicit/explicit timestepper to alleviate the very
restrictive timestep requirements that arise if we advance time in a purely
explicit fashion.  The hybrid timestepper requires the implicit operator to be
linear in the state variables and time-independent.  Precious little of the
full operator as written in
equations~\eqref{eq:state_continuity}--\eqref{eq:state_energy} meets these
criteria.  We must carve it up.

Because second derivatives give rise to the most restrictive eigenvalues for
timestepping, we focus on how second order terms enter the full operator.  We
take the quantities from sections~\ref{velocity_derivative_expansions}
and~\ref{separate_first_section_deriv} and expand the nonlinear coefficients on
second order terms about reference states.  For example, $\rho^{-1}\Delta{}m =
\lessreference{\rho^{-1}}\Delta{}m + \reference{\rho^{-1}}\Delta{}m$ where
$\reference{\rho^{-1}}$ indicates the term $\rho^{-1}$ evaluated at some given,
fixed state.  This approach separates each quantity into an explicitly-treated
nonlinear portion plus a linear contribution that satisfies our timestepper's
implicit operator needs:
\begin{subequations}
\begin{align}
\mu\Delta\frac{m}{\rho} = &\phantom{{}+}
    \mu\rho^{-2}\left[
          2\rho^{-1}m\left(\nabla\rho\right)^{2}
        - 2 \left(\nabla{}m\right)\nabla\rho
    \right]
\\
  &{}+ \lessreference{\mu\rho^{-1}} \Delta{}m
     - \lessreference{\mu\rho^{-2}m} \Delta\rho
\\
  &{}+ \reference{\mu\rho^{-1}} \Delta{}m
     - \reference{\mu\rho^{-2}m} \Delta\rho
\\
\left(\mu+\lambda\right)\nabla\nabla\cdot\frac{m}{\rho} = &\phantom{{}+}
   \left(\mu+\lambda\right)\rho^{-2}\left[
       \left(2\rho^{-1}\nabla\rho\cdot{}m-\nabla\cdot{}m\right)\nabla\rho
     - \trans{\nabla{}m}\nabla\rho
   \right]
\\
  &{}+ \lessreference{\left(\mu+\lambda\right)\rho^{-1}} \nabla\nabla\cdot{}m
     - \nabla\nabla\rho \lessreference{\left(\mu+\lambda\right)\rho^{-2}m}
\\
  &{}+ \reference{\left(\mu+\lambda\right)\rho^{-1}} \nabla\nabla\cdot{}m
     - \nabla\nabla\rho \reference{\left(\mu+\lambda\right)\rho^{-2}m}
\\
\Delta{}p =
  &{}- \left(\gamma-1\right)\rho^{-1}\left[
             \trace\left(\trans{\nabla{}m}\nabla{}m\right)
           - \rho^{-1}\left[
               2\trans{\nabla{}m}m\cdot\nabla{}\rho
             - \rho^{-1} m^2 \left(\nabla\rho\right)^{2}
           \right]
       \right]
\\
  &{}+ \left(\gamma-1\right)\Delta{}e
     - \left(\gamma-1\right)\rho^{-1}m\cdot\Delta{}m
     + \frac{\gamma-1}{2}\rho^{-2}m^2 \Delta\rho
\\
\mu\Delta{}T =
  &{}- 2\gamma\mu\rho^{-2}\nabla\rho\cdot
       \left(\nabla{}p-\rho^{-1}p\nabla\rho\right)
     + \gamma\mu\rho^{-1}\Delta{}p
     - \gamma\mu\rho^{-2}p\Delta\rho
\\
=
  &{}- 2\gamma\mu\rho^{-2}\nabla{}\rho\cdot
       \left(\nabla{}p-\rho^{-1}p\nabla\rho\right)
\\
  &{}- \gamma\left(\gamma-1\right)\mu\rho^{-2}\left[
             \trace\left(\trans{\nabla{}m}\nabla{}m\right)
           - \rho^{-1}\left[
               2\trans{\nabla{}m}m\cdot\nabla{}\rho
             - \rho^{-1} m^2 \left(\nabla\rho\right)^{2}
           \right]
       \right]
\\
  &{}+ \gamma\left(\gamma-1\right)\lessreference{\mu\rho^{-1}}\Delta{}e
     - \gamma\left(\gamma-1\right)\lessreference{\mu\rho^{-2}m}\cdot\Delta{}m
\\
  &{}+ \gamma\lessreference{
          \mu\rho^{-2}\left( \frac{\gamma-1}{2}\rho^{-1}m^2 - p \right)
       }\Delta\rho
\\
  &{}+ \gamma\left(\gamma-1\right)\reference{\mu\rho^{-1}}\Delta{}e
     - \gamma\left(\gamma-1\right)\reference{\mu\rho^{-2}m}\cdot\Delta{}m
   {}+ \gamma\reference{
          \mu\rho^{-2}\left( \frac{\gamma-1}{2}\rho^{-1}m^2 - p \right)
       }\Delta\rho
\end{align}
\end{subequations}
The last line of each quantity is the implicit portion.  Note that we will
recover an explicit-only operator if we choose identically zero reference
values.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%% Bibliography %%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\bibliographystyle{amsplain}
\bibliography{derivation}



\end{document}
