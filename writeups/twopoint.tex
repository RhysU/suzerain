\documentclass[letterpaper,11pt,nointlimits,reqno]{amsart}

% Packages
\usepackage{accents}
\usepackage{array}
\usepackage{algorithm}
\usepackage{algorithmic}
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{booktabs}
\usepackage{cancel}
\usepackage{enumerate}
\usepackage{fancyhdr}
\usepackage{fullpage}
\usepackage{ifthen}
\usepackage{lastpage}
\usepackage{latexsym}
\usepackage{listings}
\usepackage{mathrsfs}
\usepackage{mathtools}
\usepackage[numbers,sort&compress]{natbib}
\usepackage{parskip}
\usepackage{pstricks}
\usepackage{setspace}
\usepackage{todonotes}
\usepackage{txfonts}
\usepackage{units}
\usepackage{varioref}
\usepackage{wrapfig}

\mathtoolsset{showonlyrefs,showmanualtags}

% Line Spacing
\singlespacing

% Set appropriate header/footer information on each page
\fancypagestyle{plain}{
    \fancyhf{}
    \renewcommand{\headheight}{2.0em}
    \renewcommand{\headsep}{0.75em}
    \renewcommand{\headrulewidth}{1.0pt}
    \renewcommand{\footrulewidth}{0pt}
    \lhead{
        Two-point correlations computations using Suzerain's discretization
    }
    \rhead{
        Page \thepage{} of \pageref{LastPage}
    }
}
\pagestyle{plain}

% Document-specific commands
\newcommand{\ii}{\ensuremath{\mathrm{i}}}
\newcommand{\htrans}[1]{{#1}^{\ensuremath{\mathsf{H}}}}
\newcommand{\trans}[1]{{#1}^{\ensuremath{\mathsf{T}}}}
\newcommand{\OO}[1]{\operatorname{O}\left(#1\right)}

\begin{document}

In this document we detail how to compute two-point correlations.  The material
is based upon \citet[\textsection{}6.4--5]{Pope2000Turbulent} and the notation
is changed to make it consistent with Suzerain's documentations.  Where
necessary, these computations are specialized for Suzerain's discretization.  In
this discretization, any instantaneous, real-valued field
$u\!\left(x,y,z\right)$ on the spatial domain
$\left[-\frac{L_x}{2},\frac{L_x}{2}\right] \times{} [0,L_y] \times{}
\left[-\frac{L_z}{2},\frac{L_z}{2}\right]$ is discretized as
\begin{align}
  u^h(x,y,z)
&=
  \sum_{l=0}^{N_y - 1}
  \sum_{m=-\frac{N_x}{2}}^{\frac{N_x}{2}-1}
  \sum_{n=-\frac{N_z}{2}}^{\frac{N_z}{2}-1}
  \hat{u}_{l m n}
  B_l\!\left(y\right)
  e^{\ii\frac{2\pi{}m}{L_x}x}
  e^{\ii\frac{2\pi{}n}{L_z}z}
=
  \sum_{l}\sum_{m}\sum_{n}
  \hat{u}_{l m n}B_l\!\left(y\right)e^{\ii k_m x}e^{\ii k_n z}
\end{align}
where $k_m = 2\pi{}m/L_x$, $k_n = 2\pi{}n/L_z$, and $B_l\!\left(y\right)$ are a
B-spline basis for some order and some knot selection.

\section{Two-point correlation
         \citep[\textsection{}6.3]{Pope2000Turbulent}}

\subsection{As a function of separation in both $x$ and $z$}

For any two real-valued, continuous functions $u$ and $v$,
\begin{align}
R_{uv} \left( \vec{x}, \vec{r}, t \right)
  &=   \overline{
       u \left( \vec{x}+ \vec{r}, t \right)
       v \left( \vec{x}         , t \right)
       }
       .
\end{align}
Expanding position vector $\vec{x}$ and separation vector $\vec{r}$ into their
scalar components and invoking stationary,
\begin{align}
R_{uv} \left( x, r_x, y, r_y, z, r_z \right)
  &=   \overline{
       u \left( x + r_x, y + r_y, z + r_z \right)
       v \left( x      , y      , z       \right)
       }
       .
\end{align}
When the $x$ and $z$ directions are homogeneous and only $r_y=0$ is of interest
for some fixed $y_j$,
\begin{align}
R_{uv} \left( r_x, y_j, r_z \right)
  &=   \overline{
       u \left( x + r_x, y_j, z + r_z \right)
       v \left( x      , y_j, z       \right)
       }
\\
  &= \frac{1}{L_x L_z}
     \int_{-\frac{L_x}{2}}^{\frac{L_x}{2}}
     \int_{-\frac{L_z}{2}}^{\frac{L_z}{2}}
       u      \left( x + r_x, y_j, z + r_z \right)
       v^\ast \left( x      , y_j, z       \right)
     \,\mathrm{d}z
     \,\mathrm{d}x
\end{align}
Here, $\ast$ denotes complex conjugation.  Substituting $u^h$ and $v^h$ for $u$
and $v$,
\begin{multline}
R_{uv} \left( r_x, y_j, r_z \right)
   = \frac{1}{L_x L_z}
     \int_{-\frac{L_x}{2}}^{\frac{L_x}{2}}
     \int_{-\frac{L_z}{2}}^{\frac{L_z}{2}}
        \left(
         \sum_{l}\sum_{m}\sum_{n}
         \hat{u}_{l m n}B_l\left(y_j\right)
         e^{\ii k_m \left(x+r_x\right)}e^{\ii k_n \left(z+r_z\right)}
       \right)
       \\
       \left(
         \sum_{l^\prime}\sum_{m^\prime}\sum_{n^\prime}
         \hat{v}^\ast_{l^\prime m^\prime n^\prime} B_l^\prime\left(y_j\right)
         e^{-\ii k_m^\prime x}e^{-\ii k_n^\prime z}
       \right)
     \,\mathrm{d}z
     \,\mathrm{d}x
\end{multline}
Rearranging,
\begin{multline}
R_{uv} \left( r_x, y_j, r_z \right)
   = \frac{1}{L_x L_z}
     \sum_{l} B_l\left(y_j\right)
     \sum_{l^\prime} B_l^\prime\left(y_j\right)
     \\
     \sum_{m}
     \sum_{m^\prime}
     e^{\ii k_m r_x}
     \int_{-\frac{L_x}{2}}^{\frac{L_x}{2}}
     e^{\ii k_m x  }
     e^{-\ii k_m^\prime x}
     \sum_{n}
     \sum_{n^\prime}
     \hat{u}_{l m n}
     \hat{v}^\ast_{l^\prime m^\prime n^\prime}
     e^{\ii k_n r_z}
     \int_{-\frac{L_z}{2}}^{\frac{L_z}{2}}
     e^{\ii k_n z  }
     e^{-\ii k_n^\prime z}
     \,\mathrm{d}z
     \,\mathrm{d}x
\end{multline}
By the orthogonality of the Fourier basis,
\begin{align}
R_{uv} \left( r_x, y_j, r_z \right)
  &= \frac{1}{L_x}
     \sum_{l} B_l\left(y_j\right)
     \sum_{l^\prime} B_l^\prime\left(y_j\right)
     \sum_{m}
     \sum_{m^\prime}
     e^{\ii k_m r_x}
     \sum_{n}
     e^{\ii k_n r_z}
     \int_{-\frac{L_x}{2}}^{\frac{L_x}{2}}
     e^{\ii k_m x  }
     e^{-\ii k_m^\prime x}
     \hat{u}_{l m n}
     \hat{v}^\ast_{l^\prime m^\prime n}
     \,\mathrm{d}x
\\
  &= \sum_{l} B_l\left(y_j\right)
     \sum_{l^\prime} B_l^\prime\left(y_j\right)
     \sum_{m}
     e^{\ii k_m r_x}
     \sum_{n}
     e^{\ii k_n r_z}
     \hat{u}_{l m n}
     \hat{v}^\ast_{l^\prime m n}
\end{align}
Introducing shorthand $\phi_{y_j} = \sum_{l} B_l\left(y_j\right) \phi_l$
denoting evaluating the B-spline basis expansion at point $y_j$,
\begin{align}
R_{uv} \left( r_x, y_j, r_z \right)
  &=
     \sum_{m}
     \sum_{n}
     \hat{u}_{y_j m n}
     \hat{v}^\ast_{y_j m n}
     e^{\ii k_m r_x}
     e^{\ii k_n r_z}
  \label{eq:twopoint_physical_xz}
\end{align}

\todo[inline]{Relative to what I expect, this looks weird.}
Towards efficiently computing this result, relabel $x = r_x$, $z = r_z$,
$m^\prime = m$, and $n^\prime = n$,
\begin{align}
R_{uv} \left( x, y_j, z \right)
  &=
     \sum_{m^\prime}
     e^{\ii k_m^\prime x}
     \sum_{n^\prime}
     e^{\ii k_n^\prime z}
     \hat{u}_{y_j m^\prime n^\prime}
     \hat{v}^\ast_{y_j m^\prime n^\prime}
\end{align}
Applying the Fourier transform in $x$ and $z$ and taking advantage of
orthogonality,
\begin{align}
     \left(\hat{R}_{uv}\right)_{y_j m n}
  &=
     \int_{-\frac{L_x}{2}}^{\frac{L_x}{2}}
     \int_{-\frac{L_z}{2}}^{\frac{L_z}{2}}
     e^{-\ii k_m x}
     e^{-\ii k_n x}
     R_{uv} \left( x, y_j, z \right)
     \,\mathrm{d}z
     \,\mathrm{d}x
\\
  &=
     L_x L_z \hat{u}_{y_j m n} \hat{v}^\ast_{y_j m n}.
\end{align}
Evidently, the Fourier representation of the two-point correlation function
evaluated at collocation point $y_j$ is nothing but the scaled product of
identical coefficient representations of $u$ and $v$.  Directly employing the
two dimensional convolution theorem to bivariate functions $u(x, y_j, z)$ and
$v(x, y_j, z)$ permits arriving at this conclusion in one step.  Therefore,
computation of $R_{uv}$ is most effectively performed in Fourier space via
conveniently parallel, complex-valued wavenumber products once a
collocation-based B-spline mass matrix has been applied to $\hat{u}_{lmn}$ and
$\hat{v}^\ast_{lmn}$ to convert them to $\hat{u}_{y_j m n}$ and
$\hat{v}^\ast_{y_j m n}$.

\subsection{As a function of separation in only $x$}

Setting both $r_y = r_z = 0$ one can obtain the two-point correlation as a
function of only $x$.  Replaying the above derivation through
\eqref{eq:twopoint_physical_xz},
\begin{align}
R_{uv} \left( r_x, y_j, 0 \right)
  &=
     \sum_{m}
     \sum_{n}
     \hat{u}_{y_j m n}
     \hat{v}^\ast_{y_j m n}
     e^{\ii k_m r_x}
\end{align}
Relabeling $x = r_x$ and $m'=m$,
\begin{align}
R_{uv} \left( x, y_j, 0 \right)
  &=
     \sum_{m^\prime}
     e^{\ii k_m^\prime x}
     \sum_{n}
     \hat{u}_{y_j m^\prime n}
     \hat{v}^\ast_{y_j m^\prime n}
\end{align}
Applying a Fourier transformation in $x$,
\begin{align}
     \left(\hat{R}_{uv}\right)_{y_j m \, 0}
  &=
     \int_{-\frac{L_x}{2}}^{\frac{L_x}{2}}
     e^{-\ii k_m x}
     R_{uv} \left( x, y_j, 0 \right)
     \,\mathrm{d}x
\\
  &=
     L_x
     \sum_{n}
     \hat{u}_{y_j m n}
     \hat{v}^\ast_{y_j m n}
\end{align}
where the summation is over $n \in \left\{-N_z/2, \dots, 0, \dots,
N_z/2-1\right\}$.

\subsection{As a function of separation in only $z$}

Setting $r_x = r_y = 0$ as above, one finds
\begin{align}
R_{uv} \left( 0, y_j, r_z \right)
  &=
     \sum_{m}
     \sum_{n}
     \hat{u}_{y_j m n}
     \hat{v}^\ast_{y_j m n}
     e^{\ii k_n r_z}
\end{align}
and consequently
\begin{align}
     \left(\hat{R}_{uv}\right)_{y_j 0 \, n}
  &=
     L_z
     \sum_{m}
     \hat{u}_{y_j m n}
     \hat{v}^\ast_{y_j m n}
\end{align}
where the summation is over $m \in \left\{-N_x/2, \dots, 0, \dots,
N_x/2-1\right\}$.

When $u$ and $v$ are real-valued and the $x$ direction storage employs
conjugate symmetry as an optimization technique, as in Suzerain, care must be
taken when evaluating such summations.  More concretely, say one employs
conjugate symmetry in the $x$ direction when computing $f\left(\hat{u}_{y_j m
n}, \hat{v}^\ast_{y_j m n}\right)$.  Then
\begin{align}
  \sum_{m=-\frac{N_x}{2}}^{\frac{N_x}{2}-1}
  f\left(\hat{u}_{y_j m n}, \hat{v}^\ast_{y_j m n}\right)
&=
    \sum_{m=0}^{\frac{N_x}{2}-1}
    f\left(\hat{u}_{y_j m n}, \hat{v}^\ast_{y_j m n}\right)
    +
    \sum_{m=-\frac{N_x}{2}}^{-1}
    f\left(\hat{u}_{y_j m n}, \hat{v}^\ast_{y_j m n}\right)
\\ &=
    \sum_{m=0}^{\frac{N_x}{2}-1}
    f\left(\hat{u}_{y_j m n}, \hat{v}^\ast_{y_j m n}\right)
    +
    \sum_{m=1}^{\frac{N_x}{2}}
    f\left(\hat{u}^\ast_{y_j m n}, \hat{v}_{y_j m n}\right)
\\ &=
    \left.f\left(\hat{u}_{y_j m n}, \hat{v}^\ast_{y_j m n}\right)\right|_{m=0}
    +
    \sum_{m=1}^{\frac{N_x}{2}-1}
    \left[
      f\left(\hat{u}_{y_j m n}, \hat{v}^\ast_{y_j m n}\right)
      +
      f\left(\hat{u}^\ast_{y_j m n}, \hat{v}_{y_j m n}\right)
    \right]
    +
    \left.f\left(\hat{u}^\ast_{y_j m n}, \hat{v}_{y_j m n}\right)\right|_{m=\frac{N_x}{2}}
  .
\end{align}
Consequently,
\begin{align}
    L_z^{-1}
    \left(\hat{R}_{uv}\right)_{y_j 0 \, n}
&=
    \hat{u}_{y_j 0 \, n} \hat{v}^\ast_{y_j 0 \, n}
    +
    \sum_{m=1}^{\frac{N_x}{2}-1}
    \left[
      \hat{u}_{y_j m n} \hat{v}^\ast_{y_j m n}
      +
      \hat{u}^\ast_{y_j m n} \hat{v}_{y_j m n}
    \right]
    +
    \hat{u}^\ast_{y_j \frac{N_x}{2} n} \hat{v}_{y_j \frac{N_x}{2} n}
\\
&=
    \hat{u}_{y_j 0 \, n} \hat{v}^\ast_{y_j 0 \, n}
    +
    2
    \sum_{m=1}^{\frac{N_x}{2}-1}
    \left[
      \left(
        \operatorname{Re}
        \hat{u}_{y_j m n}
      \right)
      \left(
        \operatorname{Re}
        \hat{v}_{y_j m n}
      \right)
      +
      \left(
        \operatorname{Im}
        \hat{u}_{y_j m n}
      \right)
      \left(
        \operatorname{Im}
        \hat{v}_{y_j m n}
      \right)
    \right]
    +
    \hat{u}^\ast_{y_j \frac{N_x}{2} n} \hat{v}_{y_j \frac{N_x}{2} n}
  .
\end{align}

\section{One-dimensional spectra
         \citep[\textsection{}6.5]{Pope2000Turbulent}}

%FIXME: Review this one, in particular the claimed generalization
\todo[inline]{Incorrect generalization and transform scaling-- see Redmine \#2998 update 6}
Here we consider a generalization (in the sense that we will apply the formula
to any two fields) of the definiton for one-dimensional velocity spectra given
in Pope \citep[\textsection{}6.3]{Pope2000Turbulent}, where the fields are any
two velocity components.  The one-dimensional spectra along the
$\vec{r}_{xz1}$-direction  $\hat{E}_{u,v}(y_j,\vec{k}_{xz1})$ are defined to be twice
the one-dimensional Fourier transform of $R_{u,v}(y_j,\vec{r}_{xz1})$:
%
\begin{equation}
\hat{E}_{uv}(y_j,\vec{k}_{xz1}) = \frac{1}{\pi} \int_{-\infty}^{\infty}
                           R_{uv}(y_j,\vec{r}_{xz1})
                           e^{-i \vec{k}_{xz1} \vec{r}_{xz1}} \,d\!r_{xz1}
\end{equation}
%

\newcommand*{\doi}[1]{\href{http://dx.doi.org/\detokenize{#1}}{doi: #1}}
\bibliographystyle{plainnat}
\bibliography{references}

\end{document}
